<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AB-Commerce Website</title>
    <!-- style css -->
    <link rel="stylesheet" href="./style.css" />
    <!-- font awesome cdn -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
    />
    <!-- remix icon cdn -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.css"
    />
    <!-- swiper slide cdn -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/11.0.5/swiper-bundle.css"
    />
  </head>
  <body>
    <nav>
      <div class="nav-top">
        <div class="nav-top-left nav-top-content">
          <ul class="main-menu">
            <li>
              <span class="main-menu-text"
                >English <i class="fa-solid fa-chevron-down"></i
              ></span>
              <ul class="sub-menu">
                <li>
                  <span>English</span>
                </li>
                <li>
                  <span>Spanish</span>
                </li>
              </ul>
            </li>
          </ul>
          <ul class="main-menu">
            <li>
              <span class="main-menu-text"
                >USD <i class="fa-solid fa-chevron-down"></i
              ></span>
              <ul class="sub-menu">
                <li>
                  <span>USD</span>
                </li>
                <li>
                  <span>COP</span>
                </li>
              </ul>
            </li>
          </ul>
          <p>Entregas gratis en compras sobre $100</p>
        </div>
        <ul class="nav-top-right nav-top-content">
          <li>
            <i class="fa-solid fa-bolt"></i>
            <a href="#">Flash Sale</a>
          </li>
          <li>
            <a href="./about.html">Nosotros</a>
          </li>
          <li>
            <a href="./contact.html">Contacto</a>
          </li>
        </ul>
      </div>
      <div class="nav-middel">
        <div class="logo">
          <a href="index.html">
            <h2>AB<span>Commerce</span></h2>
          </a>
        </div>
        <div class="nav-middel-input-box">
          <select>
            <option>Categorías</option>
            <option>Cámaras</option>
            <option>Accesorios</option>
            <option>Cámaras y lentes</option>
            <option>Drones</option>
            <option>Laptops</option>
            <option>Videojuegos</option>
          </select>
          <input type="text" placeholder="Buscar productos" />
          <button class="btn">
            <a href="#">Buscar</a>
          </button>
        </div>
        <div class="nav-middel-right">
          <div class="nav-middel-right-content">
            <a  href="./contact.html" class="nav-middel-right-icon">
              <i class="ri-customer-service-line"></i>
            </a>
            <div class="nav-middel-right-info">
              <span>¿Tiene preguntas?</span>
              <span>+09 9987 7931</span>
            </div>
          </div>
          <div class="nav-middel-right-content">
            <a href="./myAccount.html" class="nav-middel-right-icon">
              <i class="ri-user-3-line"></i>
              <div class="nav-middel-right-info">
                <span>Cuenta</span>
                <span>Ingresar</span>
              </div>
            </a>
          </div>
          <div class="nav-middel-right-content">
            <a href="./carts.html" class="nav-middel-right-icon">
              <i class="ri-shopping-cart-2-line"></i>

              <div class="nav-middel-right-info">
                <span>Mi</span>
                <span>Carrito</span>
              </div>
            </a>
          </div>
          <div class="nav-middel-right-content">
                <i class="ri-menu-line" id="open-menu"></i>
            </div>
        </div>
        
      </div>
      <div class="nav-bottom">
            <div class="nav-bottom-left">
                <div class="categories">
                    <div class="categories-text">
                        <i class="ri-menu-line"></i>
                        <span>Categorías</span>
                    </div>
                    <i class="ri-arrow-down-s-line"></i>
                </div>

                <ul class="categories-item-menu">
                    <a href="./product.html">
                        <li>
                            <i class="fa-solid fa-mobile-screen-button"></i>
                            <span>Celulares</span>
                        </li>
                    </a>

                    <a href="./product.html">
                        <li>
                            <i class="fa-solid fa-laptop"></i>
                            <span>Laptops</span>
                        </li>
                    </a>

                    <a href="./product.html">
                        <li>
                            <i class="fa-solid fa-camera-retro"></i>
                            <span>Cámaras</span>
                        </li>
                    </a>

                    <a href="./product.html">
                        <li>
                            <i class="fa-solid fa-headphones-simple"></i>
                            <span>Audífonos</span>
                        </li>
                    </a>

                    <a href="./product.html">
                        <li>
                            <i class="fa-solid fa-gamepad"></i>
                            <span>PC Gaming</span>
                        </li>
                    </a>

                    <a href="./product.html">
                        <li>
                            <i class="fa-solid fa-tablet"></i>
                            <span>Tablets</span>
                        </li>
                    </a>

                    <a href="./product.html">
                        <li>
                            <i class="fa-solid fa-tv"></i>
                            <span>Televisiones</span>
                        </li>
                    </a>

                </ul>
            </div>

            <ul class="nav-bottom-menu">
              <li>
                <a href="index.html">Inicio</a>
              </li>
              <li>
                <a href="./product.html">Laptops</a>
              </li>
              <li>
                <a href="./product.html">Celulares</a>
              </li>
              <li>
                <a href="./product.html">Audífonos</a>
              </li>
              <li>
                <a href="./product.html">Cámaras</a>
              </li>
            </ul>
            <a href="./wishlist.html">
              <div class="vislist">
                <i class="fa-regular fa-heart"></i>
                <div class="today-deals">
                  <span>Promoción de</span>
                  <span>hoy</span>
                </div>
              </div>
            </a>
            <i class="ri-close-large-fill" id="close-menu"></i>
        </div>
    </nav>
    
    <div class="page-section">
      <h2>
        <a href="./index.html">Inicio /</a>
        <p id="product-name-title">Carrito</p>
      </h2>
    </div>

    <section class="shop-cart-container">
        <div class="sc-top">
            <h2>Mi Carrito</h2>
        </div>

        <div class="cart-wrapper">
            <div class="cart-main">
                <table style="border-color: transparent;">
                    <thead>
                        <tr>
                            <th class="product-name">Productos</th>
                            <th class="product-price">Precio</th>
                            <th class="product-quantity">Cantidad</th>
                            <th class="product-subtotal">Subtotal</th>
                            <th class="product-remove"></th>
                        </tr>
                    </thead>
                    <tbody id="cartItem">
                    </tbody>
                </table>
                
                <div class="cart-option-btn">
                    <button id="emptyCart">Vaciar carrito</button>
                </div>
            </div>

            <div class="cart-total">
                <div class="ct-top">
                    <h2>Total compra</h2>
                </div>
                <div class="ct-col">
                    <h3>Subtotal</h3>
                </div>
                <div class="ct-tol border-remove">
                    <h3>Total</h3>
                    <h3 id="cartTotal">$0</h3>
                </div>
                <a href="#" style="width: 100%;">
                    <button id="btn-checkout">Generar factura</button>
                </a>
            </div>
        </div>
    </section>
  
    <!-- footer start -->
         <footer>
          <div class="news-letter-wrapper">
            <div class="news-letter">
              <h3>Subscribete para recibir novedades y 20% de descuento</h3>
              <div>
                <input type="text" placeholder="Tu dirección de correo electrónico">
                <button class="btn">Subscribete</button>
              </div>
            </div>
          </div>

          <div class="feature-wrapper">
            <div class="features">
              <i class="ri-truck-line"></i>
              <p><strong>Envío gratis</strong>Por compras superiores a $100</p>
            </div>
            <div class="features">
              <i class="ri-money-dollar-circle-line"></i>
              <p><strong>Devoluciones</strong>Garantizadas antes de 7 días</p>
            </div>
            <div class="features">
              <i class="ri-customer-service-line"></i>
              <p><strong>Soporte 24/7</strong>Soporte 24 horas todos los días</p>
            </div>
            <div class="features">
              <i class="ri-customer-service-line"></i>
              <p><strong>Pagos</strong>pagos 100% seguros</p>
            </div>
          </div>
          <div class="footer">
            <div class="footer-link">
              <div class="logo">
                <a href="./index.html">
                  <h2>AB<span>-Commerce</span></h2>
                </a>
              </div>
              <p>Encuentra nuestros almacenes</p>
              <p>Mira <a href="#">nuestras tiendas</a></p>
              <p>email@gmail.com</p>
              <p><b>+57 1234567897</b></p>
              <div class="social">
                <i class="ri-instagram-line"></i>
                <i class="ri-facebook-line"></i>
                <i class="ri-twitter-x-line"></i>
                <i class="ri-pinterest-line"></i>
              </div>
            </div>
            <div class="footer-link">
              <h3>Nosotros</h3>
              <p><a href="#">Politicas</a></p>
              <p><a href="#">Blog</a></p>
              <p><a href="#">Noticias</a></p>
              <p><a href="#">Centro de envíos</a></p>
              <p><a href="#">Advertencias</a></p>
              <p><a href="#">Inversores</a></p>
            </div>

            <div class="footer-link">
              <h3>Soporte</h3>
              <p><a href="#">Centro de soporte</a></p>
              <p><a href="#">Gerencia</a></p>
              <p><a href="#">Servicios</a></p>
              <p><a href="#">Envíos internacionales</a></p>
              <p><a href="#">Seguridad</a></p>
              <p><a href="#">Contacto</a></p>
            </div>

            <div class="footer-link">
              <h3>Ordenes</h3>
              <p><a href="#">Ordenes aprobadas</a></p>
              <p><a href="#">Recepción y entrega</a></p>
              <p><a href="#">Devoluciones</a></p>
              <p><a href="#">Cambios</a></p>
              <p><a href="#">Desarrolladores</a></p>
              <p><a href="#">Tarjetas de regalo</a></p>
            </div>

          </div>
          <div class="tranding-tag">
            <h3>Etiquetas de tendencia</h3>
            <div class="tags">
              <span>Accesorios</span>
              <span>Apple iphone</span>
              <span>Cámara & video</span>
              <span>Celular</span>
              <span>Computadores de escritorio</span>
              <span>Electronica</span>
              <span>Videojuegos</span>
              <span>Dispositivos de juegos</span>
              <span>Audífonos</span>
              <span>Iwatch</span>
              <span>Productos para niños</span>
              <span>Laptops</span>
              <span>Mobiles & Tablets</span>
            </div>
          </div>
          <p class="copyright">© Grupo 2. All Rights Reserved.</p>
         </footer>
        <!-- footer end -->
    <!-- script js -->
    <script src="./script.js"></script>
    <!-- swiper slide cdn -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/11.0.5/swiper-bundle.min.js"></script>
    <!-- products data -->
    <script src="./data.js"></script>

    <script>
        function getQueryParam(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
      };

      const pId = getQueryParam('productId');
      const pCategory = getQueryParam('productCategory');

        let cartProducts = JSON.parse(localStorage.getItem('cartProducts')) || [];
        const cContainer = document.getElementById('cartItem');

        function createCart(){
            cartProducts.forEach(product => {
                const cId = product.productId;
                const cCategory = product.productCategory;

                // find the product based on id and category
                const cProductCategory = products.find(p => p.category == cCategory);
                console.log(cProductCategory);

                const cProduct = cProductCategory.products.find(p => p.productId == cId);
                if(cProduct){
                    // create table row
                    const cRow = document.createElement('tr');
                    const cTd1 = document.createElement('dt');
                    const cDivCartProduct = document.createElement('div');
                    cDivCartProduct.classList.add('cart-product');
                    
                    const cDivCartImg = document.createElement('div');
                    cDivCartImg.classList.add('cart-img');
                    const cImg = document.createElement('img');
                    cImg.src = cProduct.image;
                    cImg.alt = cProduct.name;
                    cDivCartImg.appendChild(cImg);

                    const cDivCartInfo = document.createElement('div');
                    cDivCartInfo.classList.add('cart-info');
                    const cH2 = document.createElement('h2');
                    cH2.textContent = cProduct.name;
                    cDivCartInfo.appendChild(cH2);

                    cDivCartProduct.appendChild(cDivCartImg);
                    cDivCartProduct.appendChild(cDivCartInfo);
                    cTd1.appendChild(cDivCartProduct);

                    const cTd2 = document.createElement('td');
                    cTd2.classList.add('price');
                    cTd2.textContent = `${cProduct.price}`

                    const cTd3 = document.createElement('td');
                    const cQuantityBox = document.createElement('div');
                    cQuantityBox.classList.add('quantity-box');
                    const cSpanMinus = document.createElement('span');
                    cSpanMinus.classList.add('minus');
                    cSpanMinus.textContent = '-'; 
                    
                    const cQuality = document.createElement('p');
                    cQuality.classList.add('value');
                    cQuality.textContent =  '1';

                    const cSpanPlus = document.createElement('span');
                    cSpanPlus.classList.add('add');
                    cSpanPlus.textContent = "+";

                    cQuantityBox.appendChild(cSpanMinus);
                    cQuantityBox.appendChild(cQuality);
                    cQuantityBox.appendChild(cSpanPlus);
                    cTd3.appendChild(cQuantityBox);

                    const cTd4 = document.createElement('td');
                    cTd4.classList.add('subtotal');
                    cTd4.textContent = `$0`;

                    const cTd5 = document.createElement('td');
                    const cRemoveIcon = document.createElement('i');
                    cRemoveIcon.classList.add('ri-close-large-fill');

                    cRemoveIcon.addEventListener('click',function(){
                      removeCardFromCart(this);
                      location.reload();
                    });

                    cTd5.appendChild(cRemoveIcon);

                    cRow.appendChild(cTd1);
                    cRow.appendChild(cTd2);
                    cRow.appendChild(cTd3);
                    cRow.appendChild(cTd4);
                    cRow.appendChild(cTd5);

                    cContainer.appendChild(cRow);
                }
                else{
                  console.log('product not found for id',pId)
                }                
            })
        }
        
        function removeCardFromCart(index){
          cartProducts.splice(index, 1);
          localStorage.setItem(`cartProducts`, JSON.stringify(cartProducts));
          createCart();
        }
        createCart();

        document.getElementById('emptyCart').addEventListener('click',function(){
          localStorage.removeItem('cartProducts');
          location.reload()
        })

        let addBtn = document.querySelectorAll('.add');
        let minusBtn = document.querySelectorAll('.minus');
        let values = document.querySelectorAll('.value');
        let prices = document.querySelectorAll('.price');        
        let subTotals = document.querySelectorAll('.subtotal');

        let cardTotal = document.getElementById('cartTotal');

        let counts = Array(values.length).fill(1);

        function updateCartTotal(){
          let total = 0;
          subTotals.forEach(subtotal => {
            total += parseFloat(subtotal.textContent.replace('$',''));
          });
          cardTotal.textContent = '$' +total.toFixed(2);
        }
        function updateSubtotal(index){
          const cPrice = parseFloat(prices[index].textContent.replace('$',''));
          const cQuantity = counts[index];
          const cSubTotal = cPrice * cQuantity;

          subTotals[index].textContent = '$' + cSubTotal.toFixed(2);
          updateCartTotal();
        }

        addBtn.forEach((btn,index) =>{
          btn.addEventListener('click',function(){
            counts[index]++;
            values[index].textContent = counts[index];
            updateSubtotal(index);
          });          
        });

        minusBtn.forEach((minusBtn,index) =>{
          minusBtn.addEventListener('click',function(){
            if(counts[index] >1){
              counts[index]--;
              values[index].textContent = counts[index];              
              updateSubtotal(index);
            }
          });
        });

        subTotals.forEach((_, index) =>{
          updateSubtotal(index);          
        })

        document.getElementById('btn-checkout').addEventListener('click', function(){
          let total = cardTotal.innerText;
          window.location.href = `./checkout.html?total=${total}`;
          });
    </script>
      
  </body>
</html>